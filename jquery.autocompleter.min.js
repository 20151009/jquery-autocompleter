/* 
 * Autocompleter v0.0.6 - 2014-05-11 
 * Simple, easy, customisable and with cache support. 
 * http://github.com/ArtemFitiskin/jquery-autocompleter 
 * 
 * Copyright 2014 Artem Fitiskin; MIT Licensed 
 */ 

!function(a,b){"use strict";function c(b){b=a.extend({},J,b||{}),null===F&&(F=a("body"));for(var c=a(this),e=0,f=c.length;f>e;e++)d(c.eq(e),b);return c}function d(b,c){if(!b.hasClass("autocompleter-node")){c=a.extend({},c,b.data("autocompleter-options"));var d='<div class="autocompleter '+c.customClass.join(" ")+'" id="autocompleter-'+(z+1)+'">';c.hint&&(d+='<div class="autocompleter-hint"></div>'),d+='<ul class="autocompleter-list"></ul>',d+="</div>",b.addClass("autocompleter-node").after(d);var e=b.next(".autocompleter").eq(0),f=b.attr("autocomplete");b.attr("autocomplete","off");var g=a.extend({$node:b,$autocompleter:e,$selected:null,$list:null,index:-1,hintText:!1,source:!1,jqxhr:!1,response:null,focused:!1,query:"",originalAutocomplete:f,guid:z++},c);g.$autocompleter.on("mousedown.autocompleter",".autocompleter-item",g,q).data("autocompleter",g),g.$node.on("keyup.autocompleter",g,i).on("keydown.autocompleter",g,j).on("focus.autocompleter",g,k).on("blur.autocompleter",g,l).on("mousedown.autocompleter",g,m)}}function e(b){if(b.query=b.$node.val().trim(),!b.empty&&0===b.query.length)return void f(b);if("object"==typeof b.source){f(b);var c=a.grep(b.source,function(a){return-1!=a.label.toUpperCase().indexOf(b.query.toUpperCase())}).filter(function(a,c){return c<b.limit});c.length&&g(c,b)}else{b.jqxhr&&b.jqxhr.abort();var d=a.extend({limit:b.limit,query:b.query},b.combine());b.jqxhr=a.ajax({url:b.source,dataType:"json",data:d,beforeSend:function(a){if(b.$autocompleter.addClass("autocompleter-ajax"),f(b),b.cache){var c=w(this.url);c&&(a.abort(),g(c,b))}}}).done(function(a){b.cache&&v(this.url,a),g(a,b)}).always(function(){b.$autocompleter.removeClass("autocompleter-ajax")})}}function f(a){a.response=null,a.$list=null,a.$selected=null,a.index=0,a.$autocompleter.find(".autocompleter-list").empty(),a.$autocompleter.find(".autocompleter-hint").removeClass("autocompleter-hint-show").empty(),a.hintText=!1,p(null,a)}function g(a,b){h(a,b),b.$autocompleter.hasClass("autocompleter-focus")&&n(null,b)}function h(b,c){var d="";for(var e in b){var f=["autocompleter-item"];c.selectFirst&&"0"==e&&!c.changeWhenSelect&&f.push("autocompleter-item-selected");var g=new RegExp(c.query,"gi"),h=c.customLabel&&b[e][c.customLabel]?b[e][c.customLabel]:b[e].label;h=c.highlightMatches?h.replace(g,"<strong>$&</strong>"):h;var i=c.customValue&&b[e][c.customValue]?b[e][c.customValue]:b[e].value;d+=i?'<li data-value="'+i+'" class="'+f.join(" ")+'">'+h+"</li>":'<li class="'+f.join(" ")+'">'+h+"</li>"}if(b.length&&c.hint){var j=b[0].label.substr(0,c.query.length).toUpperCase()==c.query.toUpperCase()?b[0].label:!1;if(j&&c.query!=b[0].label){var g=new RegExp(c.query,"i"),k=j.replace(g,"<span>"+c.query+"</span>");c.$autocompleter.find(".autocompleter-hint").addClass("autocompleter-hint-show").html(k),c.hintText=k}}c.response=b,c.$autocompleter.find(".autocompleter-list").html(d),c.$selected=c.$autocompleter.find(".autocompleter-item-selected").length?c.$autocompleter.find(".autocompleter-item-selected"):null,c.$list=b.length?c.$autocompleter.find(".autocompleter-item"):null,c.index=c.$selected?c.$list.index(c.$selected):-1,c.$autocompleter.find(".autocompleter-item").each(function(b,d){a(d).data(c.response[b])})}function i(a){var b=a.data;if(40!=a.keyCode&&38!=a.keyCode||!b.$autocompleter.hasClass("autocompleter-show"))-1!=[13].indexOf(a.keyCode)?b.$autocompleter.hasClass("autocompleter-show")&&b.$selected?q(a):(a.preventDefault(),a.stopPropagation(),b.$node.trigger("mousedown.autocompleter")):-1==A.indexOf(a.keyCode)&&-1==b.ignoredKeyCode.indexOf(a.keyCode)&&e(b);else{var c,d,f=b.$list.length;f&&(f>1?b.index==f-1?(c=b.changeWhenSelect?-1:0,d=b.index-1):0===b.index?(c=b.index+1,d=b.changeWhenSelect?-1:f-1):-1==b.index?(c=0,d=f-1):(c=b.index+1,d=b.index-1):-1==b.index?(c=0,d=0):(d=-1,c=-1),b.index=40==a.keyCode?c:d,b.$list.removeClass("autocompleter-item-selected"),-1!=b.index&&b.$list.eq(b.index).addClass("autocompleter-item-selected"),b.$selected=b.$autocompleter.find(".autocompleter-item-selected").length?b.$autocompleter.find(".autocompleter-item-selected"):null,b.changeWhenSelect&&s(b))}}function j(a){if(40==a.keyCode||38==a.keyCode)a.preventDefault();else if(39==a.keyCode){var b=a.data;if(b.hint&&b.hintText&&b.$autocompleter.find(".autocompleter-hint").hasClass("autocompleter-hint-show")){a.preventDefault();var c=b.$autocompleter.find(".autocompleter-item").length?b.$autocompleter.find(".autocompleter-item").eq(0).text().trim():!1;c&&(b.query=c,r(b))}}}function k(a,b){if(!b){var c=a.data;c.$node.prop("disabled")||c.$autocompleter.hasClass("autocompleter-show")||(c.$autocompleter.addClass("autocompleter-focus"),c.focusOpen&&(e(c),c.focused=!0,setTimeout(function(){c.focused=!1},500)))}}function l(a,b){a.preventDefault(),a.stopPropagation();var c=a.data;b||(c.$autocompleter.removeClass("autocompleter-focus"),p(a))}function m(a){if("mousedown"!=a.type||-1==[2,3].indexOf(a.which)){var c=a.data;if(c.$list&&!c.focused&&!c.$node.is(":disabled"))if(D&&!E){var d=c.$select[0];if(b.document.createEvent){var e=b.document.createEvent("MouseEvents");e.initMouseEvent("mousedown",!1,!0,b,0,0,0,0,0,!1,!1,!1,!1,0,null),d.dispatchEvent(e)}else d.fireEvent&&d.fireEvent("onmousedown")}else c.$autocompleter.hasClass("autocompleter-closed")?n(a):c.$autocompleter.hasClass("autocompleter-show")&&p(a)}}function n(a,b){var b=a?a.data:b;!b.$node.prop("disabled")&&!b.$autocompleter.hasClass("autocompleter-show")&&b.$list&&b.$list.length&&(b.$autocompleter.removeClass("autocompleter-closed").addClass("autocompleter-show"),F.on("click.autocompleter-"+b.guid,":not(.autocompleter-item)",b,o))}function o(b){a(b.target).hasClass("autocompleter-node")||(b.preventDefault(),b.stopPropagation(),0===a(b.currentTarget).parents(".autocompleter").length&&p(b))}function p(a,b){var b=a?a.data:b;b.$autocompleter.hasClass("autocompleter-show")&&(b.$autocompleter.removeClass("autocompleter-show").addClass("autocompleter-closed"),F.off(".autocompleter-"+b.guid))}function q(b){if("mousedown"!=b.type||-1==[2,3].indexOf(b.which)){var c=b.data;b.preventDefault(),b.stopPropagation();{"keyup"==b.type&&c.$selected?c.$selected:a(this)}c.$node.prop("disabled")||(p(b),t(c),"click"==b.type&&c.$node.trigger("focus",[!0]))}}function r(a){s(a),u(a),e(a)}function s(a){if(a.$selected){a.hintText&&a.$autocompleter.find(".autocompleter-hint").hasClass("autocompleter-hint-show")&&a.$autocompleter.find(".autocompleter-hint").removeClass("autocompleter-hint-show");var b=a.$selected.attr("data-value")?a.$selected.attr("data-value"):a.$selected.text().trim();a.$node.val(b)}else a.hintText&&!a.$autocompleter.find(".autocompleter-hint").hasClass("autocompleter-hint-show")&&a.$autocompleter.find(".autocompleter-hint").addClass("autocompleter-hint-show"),a.$node.val(a.query)}function t(a){s(a),u(a),f(a)}function u(a){a.callback.call(a.$autocompleter,a.$node.val(),a.index,a.response[a.index]),a.$node.trigger("change")}function v(a,b){if(H&&a&&b){I[a]={value:b};try{localStorage.setItem(G,JSON.stringify(I))}catch(c){var d=c.code||c.number||c.message;if(22!==d)throw c;y()}}}function w(a){if(a){var b=I[a]&&I[a].value?I[a].value:!1;return b}}function x(){if(H){var a=localStorage.getItem(G)||"{}";return JSON.parse(a)}}function y(){try{localStorage.removeItem(G),I=x()}catch(a){throw a}}var z=0,A=[9,13,17,19,20,27,33,34,35,36,37,39,44,92,113,114,115,118,119,120,122,123,144,145],B=b.navigator.userAgent||b.navigator.vendor||b.opera,C=/Firefox/i.test(B),D=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(B),E=C&&D,F=null,G="autocompleterCache",H=function(){var a="undefined"!=typeof b.localStorage;if(a)try{localStorage.setItem("autocompleter","autocompleter"),localStorage.removeItem("autocompleter")}catch(c){a=!1}return a}(),I=x(),J={source:null,empty:!0,limit:10,customClass:[],cache:!0,focusOpen:!0,hint:!1,selectFirst:!1,changeWhenSelect:!0,highlightMatches:!1,ignoredKeyCode:[],customLabel:!1,customValue:!1,combine:a.noop,callback:a.noop},K={defaults:function(b){return J=a.extend(J,b||{}),a(this)},clearCache:function(){y()},destroy:function(){return a(this).each(function(b,c){var d=a(c).next(".autocompleter").data("autocompleter");d&&(d.jqxhr&&d.jqxhr.abort(),d.$autocompleter.hasClass("open")&&d.$autocompleter.find(".autocompleter-selected").trigger("click.autocompleter"),d.originalAutocomplete?d.$node.attr("autocomplete",d.originalAutocomplete):d.$node.removeAttr("autocomplete"),d.$node.off(".autocompleter").removeClass("autocompleter-node"),d.$autocompleter.off(".autocompleter").remove())})}};a.fn.autocompleter=function(a){return K[a]?K[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?this:c.apply(this,arguments)},a.autocompleter=function(a){"defaults"===a?K.defaults.apply(this,Array.prototype.slice.call(arguments,1)):"clearCache"===a&&K.clearCache.apply(this,null)}}(jQuery,window);