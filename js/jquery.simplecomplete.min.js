/*
 * jQuery Simplecomplete v0.0.1 - 2014-05-01
 *
 * Simple, easy, customisable autocomplete plugin with cache support.
 * http://github.com/ArtemFitiskin/jquery-simplecomplete
 *
 * Copyright 2014 Artem Fitiskin; MIT Licensed
 */
!function(a,b){"use strict";function o(b){b=a.extend({},m,b||{}),null===i&&(i=a("body"));for(var c=a(this),d=0,e=c.length;e>d;d++)p(c.eq(d),b);return c}function p(b,d){if(!b.hasClass("simplecomplete-node")){d=a.extend({},d,b.data("simplecomplete-options"));var e='<div class="simplecomplete '+d.customClass.join(" ")+'">';d.hint&&(e+='<div class="simplecomplete-hint"></div>'),e+='<ul class="simplecomplete-list"></ul>',e+="</div>",b.addClass("simplecomplete-node").after(e);var f=b.next(".simplecomplete").eq(0),g=b.attr("autocomplete");b.attr("autocomplete","off");var h=a.extend({$node:b,$simplecomplete:f,$selected:null,$list:null,index:-1,hintText:!1,source:!1,jqxhr:!1,query:"",originalAutocomplete:g,guid:c++},d);h.$simplecomplete.on("mousedown.simplecomplete",".simplecomplete-item",h,C).data("simplecomplete",h),h.$node.on("keyup.simplecomplete",h,u).on("keydown.simplecomplete",h,v).on("focus.simplecomplete",h,w).on("blur.simplecomplete",h,x).on("click.simplecomplete",h,y)}}function q(b){if(b.query=b.$node.val().trim(),!b.empty&&0===b.query.length)return r(b),void 0;if("object"==typeof b.source){r(b);var c=a.grep(b.source,function(a){return-1!=a.label.toUpperCase().indexOf(b.query.toUpperCase())}).filter(function(a,c){return c<b.limit});c.length&&s(c,b)}else{b.jqxhr&&b.jqxhr.abort();var d=a.extend({limit:b.limit,query:b.query},b.combine());b.jqxhr=a.ajax({url:b.source,dataType:"json",data:d,beforeSend:function(a){if(b.$simplecomplete.addClass("simplecomplete-ajax"),r(b),b.cache){var c=I(this.url);c&&(a.abort(),s(c,b))}}}).done(function(a){b.cache&&H(this.url,a),s(a,b)}).always(function(){b.$simplecomplete.removeClass("simplecomplete-ajax")})}}function r(a){a.$list=null,a.$selected=null,a.index=0,a.$simplecomplete.find(".simplecomplete-list").empty(),a.$simplecomplete.find(".simplecomplete-hint").removeClass("simplecomplete-hint-show").empty(),a.hintText=!1,B(null,a)}function s(a,b){t(a,b),b.$simplecomplete.hasClass("simplecomplete-focus")&&z(null,b)}function t(a,b){var c="";for(var d in a){var e=["simplecomplete-item"];b.selectFirst&&"0"==d&&!b.changeWhenSelect&&e.push("simplecomplete-item-selected");var f=new RegExp(b.query,"gi"),g=b.highlightmatches?a[d].label.replace(f,"<strong>$&</strong>"):a[d].label;c+='<li data-value="'+a[d].value+'" class="'+e.join(" ")+'">'+g+"</li>"}if(a.length&&b.hint){var h=a[0].label.substr(0,b.query.length).toUpperCase()==b.query.toUpperCase()?a[0].label:!1;if(h&&b.query!=a[0].label){var f=new RegExp(b.query,"i"),i=h.replace(f,"<span>"+b.query+"</span>");b.$simplecomplete.find(".simplecomplete-hint").addClass("simplecomplete-hint-show").html(i),b.hintText=i}}b.$simplecomplete.find("ul").html(c),b.$selected=b.$simplecomplete.find(".simplecomplete-item-selected").length?b.$simplecomplete.find(".simplecomplete-item-selected"):null,b.$list=a.length?b.$simplecomplete.find("ul li"):null,b.index=b.$selected?b.$list.index(b.$selected):-1}function u(a){var b=a.data;if(40==a.keyCode||38==a.keyCode){var e,f,c=b.$list.length;c&&(c>1?b.index==c-1?(e=b.changeWhenSelect?-1:0,f=b.index-1):0===b.index?(e=b.index+1,f=b.changeWhenSelect?-1:c-1):-1==b.index?(e=0,f=c-1):(e=b.index+1,f=b.index-1):-1==b.index?(e=0,f=0):(f=-1,e=-1),b.index=40==a.keyCode?e:f,b.$list.removeClass("simplecomplete-item-selected"),-1!=b.index&&b.$list.eq(b.index).addClass("simplecomplete-item-selected"),b.$selected=b.$simplecomplete.find(".simplecomplete-item-selected").length?b.$simplecomplete.find(".simplecomplete-item-selected"):null,b.changeWhenSelect&&E(b))}else-1!=[13].indexOf(a.keyCode)?b.$simplecomplete.hasClass("simplecomplete-show")&&b.$selected?C(a):(a.preventDefault(),b.$node.trigger("click.simplecomplete")):-1==d.indexOf(a.keyCode)&&-1==b.ignoredKeyCode.indexOf(a.keyCode)&&q(b)}function v(a){if(40==a.keyCode||38==a.keyCode)a.preventDefault();else if(39==a.keyCode){var b=a.data;if(b.hint&&b.hintText&&b.$simplecomplete.find(".simplecomplete-hint").hasClass("simplecomplete-hint-show")){a.preventDefault();var c=b.$simplecomplete.find(".simplecomplete-item").length?b.$simplecomplete.find(".simplecomplete-item").eq(0).text().trim():!1;c&&(b.query=c,D(b))}}}function w(a,b){if(!b){a.preventDefault(),a.stopPropagation();var c=a.data;c.$node.prop("disabled")||c.$simplecomplete.hasClass("simplecomplete-show")||(c.$simplecomplete.addClass("simplecomplete-focus"),c.focusOpen&&q(c))}}function x(a,b){a.preventDefault(),a.stopPropagation();var c=a.data;b||(c.$simplecomplete.removeClass("simplecomplete-focus"),B(a))}function y(a){a.preventDefault(),a.stopPropagation();var c=a.data;if(!c.$node.is(":disabled"))if(g&&!h){var d=c.$select[0];if(b.document.createEvent){var e=b.document.createEvent("MouseEvents");e.initMouseEvent("mousedown",!1,!0,b,0,0,0,0,0,!1,!1,!1,!1,0,null),d.dispatchEvent(e)}else d.fireEvent&&d.fireEvent("onmousedown")}else c.$simplecomplete.hasClass("simplecomplete-closed")?z(a):c.$simplecomplete.hasClass("simplecomplete-show")&&B(a)}function z(a,b){a&&(a.preventDefault(),a.stopPropagation());var b=a?a.data:b;!b.$node.prop("disabled")&&!b.$simplecomplete.hasClass("simplecomplete-show")&&b.$list&&b.$list.length&&(b.$simplecomplete.removeClass("simplecomplete-closed").addClass("simplecomplete-show"),i.on("click.simplecomplete-"+b.guid,":not(.simplecomplete-item)",b,A))}function A(b){b.preventDefault(),b.stopPropagation(),0===a(b.currentTarget).parents(".simplecomplete").length&&B(b)}function B(a,b){a&&(a.preventDefault(),a.stopPropagation());var b=a?a.data:b;b.$simplecomplete.hasClass("simplecomplete-show")&&(b.$simplecomplete.removeClass("simplecomplete-show").addClass("simplecomplete-closed"),i.off(".simplecomplete-"+b.guid))}function C(b){if("mousedown"!=b.type||-1==[2,3].indexOf(b.which)){var c=b.data;b.preventDefault(),b.stopPropagation();var d="keyup"==b.type&&c.$selected?c.$selected:a(this);if(!c.$node.prop("disabled")){var e=c.$list.index(d);B(b),F(e,c),"click"==b.type&&c.$node.trigger("focus",[!0])}}}function D(a){E(a),G(a),q(a)}function E(a){a.$selected?(a.hintText&&a.$simplecomplete.find(".simplecomplete-hint").hasClass("simplecomplete-hint-show")&&a.$simplecomplete.find(".simplecomplete-hint").removeClass("simplecomplete-hint-show"),a.$node.val(a.$selected.text().trim())):(a.hintText&&!a.$simplecomplete.find(".simplecomplete-hint").hasClass("simplecomplete-hint-show")&&a.$simplecomplete.find(".simplecomplete-hint").addClass("simplecomplete-hint-show"),a.$node.val(a.query))}function F(a,b){E(b),G(b),r(b)}function G(a){a.callback.call(a.$simplecomplete,a.$node.val(),a.index),a.$node.trigger("change")}function H(a,b){if(k&&a&&b){l[a]={value:b};try{localStorage.setItem(j,JSON.stringify(l))}catch(c){var d=c.code||c.number||c.message;if(22!==d)throw c;K()}}}function I(a){if(a){var b=l[a]&&l[a].value?l[a].value:!1;return b}}function J(){if(k){var a=localStorage.getItem(j)||"{}";return JSON.parse(a)}}function K(){try{localStorage.removeItem(j),l=J()}catch(a){throw a}}var c=0,d=[9,13,17,19,20,27,33,34,35,36,37,39,44,92,113,114,115,118,119,120,122,123,144,145],e=b.navigator.userAgent||b.navigator.vendor||b.opera,f=/Firefox/i.test(e),g=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(e),h=f&&g,i=null,j="simpleAutocompleteCache",k=function(){var a="undefined"!=typeof b.localStorage;if(a)try{localStorage.setItem("simplecomplete","simplecomplete"),localStorage.removeItem("simplecomplete")}catch(c){a=!1}return a}(),l=J(),m={source:null,empty:!0,limit:10,customClass:[],cache:!1,focusOpen:!1,hint:!1,selectFirst:!0,changeWhenSelect:!0,highlightmatches:!1,ignoredKeyCode:[],combine:a.noop,callback:a.noop},n={defaults:function(b){return m=a.extend(m,b||{}),a(this)},clearCache:function(){K()},destroy:function(){return a(this).each(function(b,c){var d=a(c).next(".simplecomplete").data("simplecomplete");d&&(d.jqxhr&&d.jqxhr.abort(),d.$simplecomplete.hasClass("open")&&d.$simplecomplete.find(".simplecomplete-selected").trigger("click.simplecomplete"),d.originalAutocomplete?d.$node.attr("autocomplete",d.originalAutocomplete):d.$node.removeAttr("autocomplete"),d.$node.off(".simplecomplete").removeClass("simplecomplete-node"),d.$simplecomplete.off(".simplecomplete").remove())})}};a.fn.simplecomplete=function(a){return n[a]?n[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?this:o.apply(this,arguments)},a.simplecomplete=function(a){"defaults"===a?n.defaults.apply(this,Array.prototype.slice.call(arguments,1)):"clearCache"===a&&n.clearCache.apply(this,null)}}(jQuery,window);
