/* 
 * Simplecomplete v0.0.1 - 2014-05-01 
 * Simple, easy, customisable and with cache support. 
 * http://github.com/ArtemFitiskin/jquery-simplecomplete 
 * 
 * Copyright 2014 Artem Fitiskin; MIT Licensed 
 */ 

!function(a,b){"use strict";function c(b){b=a.extend({},J,b||{}),null===F&&(F=a("body"));for(var c=a(this),e=0,f=c.length;f>e;e++)d(c.eq(e),b);return c}function d(b,c){if(!b.hasClass("simplecomplete-node")){c=a.extend({},c,b.data("simplecomplete-options"));var d='<div class="simplecomplete '+c.customClass.join(" ")+'">';c.hint&&(d+='<div class="simplecomplete-hint"></div>'),d+='<ul class="simplecomplete-list"></ul>',d+="</div>",b.addClass("simplecomplete-node").after(d);var e=b.next(".simplecomplete").eq(0),f=b.attr("autocomplete");b.attr("autocomplete","off");var g=a.extend({$node:b,$simplecomplete:e,$selected:null,$list:null,index:-1,hintText:!1,source:!1,jqxhr:!1,query:"",originalAutocomplete:f,guid:z++},c);g.$simplecomplete.on("mousedown.simplecomplete",".simplecomplete-item",g,q).data("simplecomplete",g),g.$node.on("keyup.simplecomplete",g,i).on("keydown.simplecomplete",g,j).on("focus.simplecomplete",g,k).on("blur.simplecomplete",g,l).on("click.simplecomplete",g,m)}}function e(b){if(b.query=b.$node.val().trim(),!b.empty&&0===b.query.length)return void f(b);if("object"==typeof b.source){f(b);var c=a.grep(b.source,function(a){return-1!=a.label.toUpperCase().indexOf(b.query.toUpperCase())}).filter(function(a,c){return c<b.limit});c.length&&g(c,b)}else{b.jqxhr&&b.jqxhr.abort();var d=a.extend({limit:b.limit,query:b.query},b.combine());b.jqxhr=a.ajax({url:b.source,dataType:"json",data:d,beforeSend:function(a){if(b.$simplecomplete.addClass("simplecomplete-ajax"),f(b),b.cache){var c=w(this.url);c&&(a.abort(),g(c,b))}}}).done(function(a){b.cache&&v(this.url,a),g(a,b)}).always(function(){b.$simplecomplete.removeClass("simplecomplete-ajax")})}}function f(a){a.$list=null,a.$selected=null,a.index=0,a.$simplecomplete.find(".simplecomplete-list").empty(),a.$simplecomplete.find(".simplecomplete-hint").removeClass("simplecomplete-hint-show").empty(),a.hintText=!1,p(null,a)}function g(a,b){h(a,b),b.$simplecomplete.hasClass("simplecomplete-focus")&&n(null,b)}function h(a,b){var c="";for(var d in a){var e=["simplecomplete-item"];b.selectFirst&&"0"==d&&!b.changeWhenSelect&&e.push("simplecomplete-item-selected");var f=new RegExp(b.query,"gi"),g=b.highlightmatches?a[d].label.replace(f,"<strong>$&</strong>"):a[d].label;c+='<li data-value="'+a[d].value+'" class="'+e.join(" ")+'">'+g+"</li>"}if(a.length&&b.hint){var h=a[0].label.substr(0,b.query.length).toUpperCase()==b.query.toUpperCase()?a[0].label:!1;if(h&&b.query!=a[0].label){var f=new RegExp(b.query,"i"),i=h.replace(f,"<span>"+b.query+"</span>");b.$simplecomplete.find(".simplecomplete-hint").addClass("simplecomplete-hint-show").html(i),b.hintText=i}}b.$simplecomplete.find("ul").html(c),b.$selected=b.$simplecomplete.find(".simplecomplete-item-selected").length?b.$simplecomplete.find(".simplecomplete-item-selected"):null,b.$list=a.length?b.$simplecomplete.find("ul li"):null,b.index=b.$selected?b.$list.index(b.$selected):-1}function i(a){var b=a.data;if(40==a.keyCode||38==a.keyCode){var c,d,f=b.$list.length;f&&(f>1?b.index==f-1?(c=b.changeWhenSelect?-1:0,d=b.index-1):0===b.index?(c=b.index+1,d=b.changeWhenSelect?-1:f-1):-1==b.index?(c=0,d=f-1):(c=b.index+1,d=b.index-1):-1==b.index?(c=0,d=0):(d=-1,c=-1),b.index=40==a.keyCode?c:d,b.$list.removeClass("simplecomplete-item-selected"),-1!=b.index&&b.$list.eq(b.index).addClass("simplecomplete-item-selected"),b.$selected=b.$simplecomplete.find(".simplecomplete-item-selected").length?b.$simplecomplete.find(".simplecomplete-item-selected"):null,b.changeWhenSelect&&s(b))}else-1!=[13].indexOf(a.keyCode)?b.$simplecomplete.hasClass("simplecomplete-show")&&b.$selected?q(a):(a.preventDefault(),b.$node.trigger("click.simplecomplete")):-1==A.indexOf(a.keyCode)&&-1==b.ignoredKeyCode.indexOf(a.keyCode)&&e(b)}function j(a){if(40==a.keyCode||38==a.keyCode)a.preventDefault();else if(39==a.keyCode){var b=a.data;if(b.hint&&b.hintText&&b.$simplecomplete.find(".simplecomplete-hint").hasClass("simplecomplete-hint-show")){a.preventDefault();var c=b.$simplecomplete.find(".simplecomplete-item").length?b.$simplecomplete.find(".simplecomplete-item").eq(0).text().trim():!1;c&&(b.query=c,r(b))}}}function k(a,b){if(!b){a.preventDefault(),a.stopPropagation();var c=a.data;c.$node.prop("disabled")||c.$simplecomplete.hasClass("simplecomplete-show")||(c.$simplecomplete.addClass("simplecomplete-focus"),c.focusOpen&&e(c))}}function l(a,b){a.preventDefault(),a.stopPropagation();var c=a.data;b||(c.$simplecomplete.removeClass("simplecomplete-focus"),p(a))}function m(a){a.preventDefault(),a.stopPropagation();var c=a.data;if(!c.$node.is(":disabled"))if(D&&!E){var d=c.$select[0];if(b.document.createEvent){var e=b.document.createEvent("MouseEvents");e.initMouseEvent("mousedown",!1,!0,b,0,0,0,0,0,!1,!1,!1,!1,0,null),d.dispatchEvent(e)}else d.fireEvent&&d.fireEvent("onmousedown")}else c.$simplecomplete.hasClass("simplecomplete-closed")?n(a):c.$simplecomplete.hasClass("simplecomplete-show")&&p(a)}function n(a,b){a&&(a.preventDefault(),a.stopPropagation());var b=a?a.data:b;!b.$node.prop("disabled")&&!b.$simplecomplete.hasClass("simplecomplete-show")&&b.$list&&b.$list.length&&(b.$simplecomplete.removeClass("simplecomplete-closed").addClass("simplecomplete-show"),F.on("click.simplecomplete-"+b.guid,":not(.simplecomplete-item)",b,o))}function o(b){b.preventDefault(),b.stopPropagation(),0===a(b.currentTarget).parents(".simplecomplete").length&&p(b)}function p(a,b){a&&(a.preventDefault(),a.stopPropagation());var b=a?a.data:b;b.$simplecomplete.hasClass("simplecomplete-show")&&(b.$simplecomplete.removeClass("simplecomplete-show").addClass("simplecomplete-closed"),F.off(".simplecomplete-"+b.guid))}function q(b){if("mousedown"!=b.type||-1==[2,3].indexOf(b.which)){var c=b.data;b.preventDefault(),b.stopPropagation();var d="keyup"==b.type&&c.$selected?c.$selected:a(this);if(!c.$node.prop("disabled")){var e=c.$list.index(d);p(b),t(e,c),"click"==b.type&&c.$node.trigger("focus",[!0])}}}function r(a){s(a),u(a),e(a)}function s(a){a.$selected?(a.hintText&&a.$simplecomplete.find(".simplecomplete-hint").hasClass("simplecomplete-hint-show")&&a.$simplecomplete.find(".simplecomplete-hint").removeClass("simplecomplete-hint-show"),a.$node.val(a.$selected.text().trim())):(a.hintText&&!a.$simplecomplete.find(".simplecomplete-hint").hasClass("simplecomplete-hint-show")&&a.$simplecomplete.find(".simplecomplete-hint").addClass("simplecomplete-hint-show"),a.$node.val(a.query))}function t(a,b){s(b),u(b),f(b)}function u(a){a.callback.call(a.$simplecomplete,a.$node.val(),a.index),a.$node.trigger("change")}function v(a,b){if(H&&a&&b){I[a]={value:b};try{localStorage.setItem(G,JSON.stringify(I))}catch(c){var d=c.code||c.number||c.message;if(22!==d)throw c;y()}}}function w(a){if(a){var b=I[a]&&I[a].value?I[a].value:!1;return b}}function x(){if(H){var a=localStorage.getItem(G)||"{}";return JSON.parse(a)}}function y(){try{localStorage.removeItem(G),I=x()}catch(a){throw a}}var z=0,A=[9,13,17,19,20,27,33,34,35,36,37,39,44,92,113,114,115,118,119,120,122,123,144,145],B=b.navigator.userAgent||b.navigator.vendor||b.opera,C=/Firefox/i.test(B),D=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(B),E=C&&D,F=null,G="simpleAutocompleteCache",H=function(){var a="undefined"!=typeof b.localStorage;if(a)try{localStorage.setItem("simplecomplete","simplecomplete"),localStorage.removeItem("simplecomplete")}catch(c){a=!1}return a}(),I=x(),J={source:null,empty:!0,limit:10,customClass:[],cache:!1,focusOpen:!1,hint:!1,selectFirst:!0,changeWhenSelect:!0,highlightmatches:!1,ignoredKeyCode:[],combine:a.noop,callback:a.noop},K={defaults:function(b){return J=a.extend(J,b||{}),a(this)},clearCache:function(){y()},destroy:function(){return a(this).each(function(b,c){var d=a(c).next(".simplecomplete").data("simplecomplete");d&&(d.jqxhr&&d.jqxhr.abort(),d.$simplecomplete.hasClass("open")&&d.$simplecomplete.find(".simplecomplete-selected").trigger("click.simplecomplete"),d.originalAutocomplete?d.$node.attr("autocomplete",d.originalAutocomplete):d.$node.removeAttr("autocomplete"),d.$node.off(".simplecomplete").removeClass("simplecomplete-node"),d.$simplecomplete.off(".simplecomplete").remove())})}};a.fn.simplecomplete=function(a){return K[a]?K[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?this:c.apply(this,arguments)},a.simplecomplete=function(a){"defaults"===a?K.defaults.apply(this,Array.prototype.slice.call(arguments,1)):"clearCache"===a&&K.clearCache.apply(this,null)}}(jQuery,window);